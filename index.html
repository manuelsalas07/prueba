<script src="https://www.sandbox.cybersource.com/checkout.js"></script>
<script>
    document.getElementById("payButton").addEventListener("click", function() {
        console.log("Llamando a get-jwt");

        // Realizar la solicitud GET usando axios
        axios.get('https://d4a1-201-206-191-87.ngrok-free.app/get-jwt')
            .then(function(response) {
                const data = response.data;
                console.log("Respuesta del servidor:", data);

                // Verificar si se recibió el JWT
                if (data && data.jwt) {
                    console.log('JWT recibido:', data.jwt);  // Verificar en la consola si el JWT se está recibiendo

                    // Inicializar el botón de pago de CyberSource
                    CyberSourceCheckout.configure({
                        jwt: data.jwt,
                        paymentTypes: ['CREDIT_CARD'],
                        orderAmount: '21.00',  // Asegúrate de que el monto coincida con el JWT
                        orderCurrency: 'USD',
                        onSuccess: function(response) {
                            // Aquí manejas la respuesta exitosa (por ejemplo, puedes redirigir o mostrar un mensaje)
                            console.log('Pago exitoso', response);
                        },
                        onError: function(error) {
                            // Aquí manejas errores en caso de que algo falle en el proceso de pago
                            console.error('Error en el pago', error);
                        }
                    });

                    // Abre la ventana del widget de pago
                    CyberSourceCheckout.show();
                } else {
                    alert('No se pudo obtener el JWT o el formato es incorrecto');
                }
            })
            .catch(function(error) {
                // Manejar errores
                console.error('Error al obtener JWT:', error);
                alert('Error al obtener JWT');
            });
    });
</script>
